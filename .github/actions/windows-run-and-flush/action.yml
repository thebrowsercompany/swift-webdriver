name: "Run a command and flush stdout"
description: "Helper to flush the stdout buffer in case a command ends abruptly."

inputs:
  cmd-exec:
    description: Command to execute
    required: true
  cmd-args:
    description: Arguments to the command line
    required: false
    default: ""
  working-directory:
    required: false
    default: ${{ github.workspace }}

runs:
  using: "composite"
  steps:
    - name: Run
      working-directory: ${{ inputs.working-directory }}
      shell: pwsh
      run: |
        & '${{ inputs.cmd-exec }}' '${{ inputs.cmd-args }}'
        Write-Output "Flushing"
        [Console]::Out.Flush()
        exit $LASTEXITCODE
